<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parallel HDF5 · HDF5.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://JuliaIO.github.io/HDF5.jl/mpi/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img class="docs-light-only" src="../assets/logo.svg" alt="HDF5.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="HDF5.jl logo"/></a><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Interface</span><ul><li><a class="tocitem" href="../interface/configuration/">Configuration</a></li><li><a class="tocitem" href="../interface/files/">Files</a></li><li><a class="tocitem" href="../interface/groups/">Groups</a></li><li><a class="tocitem" href="../interface/dataspaces/">Dataspaces</a></li><li><a class="tocitem" href="../interface/dataset/">Dataset</a></li><li><a class="tocitem" href="../interface/attributes/">Attributes</a></li><li><a class="tocitem" href="../interface/properties/">Properties</a></li><li><a class="tocitem" href="../interface/filters/">Filters</a></li><li><a class="tocitem" href="../interface/objects/">Objects</a></li></ul></li><li class="is-active"><a class="tocitem" href>Parallel HDF5</a><ul class="internal"><li><a class="tocitem" href="#Setting-up-Parallel-HDF5"><span>Setting-up Parallel HDF5</span></a></li></ul></li><li><a class="tocitem" href="../api_bindings/">Low-level library bindings</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Parallel HDF5</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Parallel HDF5</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaIO/HDF5.jl/blob/master/docs/src/mpi.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Parallel-HDF5"><a class="docs-heading-anchor" href="#Parallel-HDF5">Parallel HDF5</a><a id="Parallel-HDF5-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-HDF5" title="Permalink"></a></h1><p>It is possible to read and write <a href="https://portal.hdfgroup.org/display/HDF5/Parallel+HDF5">parallel HDF5</a> files using MPI. For this, the HDF5 binaries loaded by HDF5.jl must have been compiled with parallel support, and linked to the specific MPI implementation that will be used for parallel I/O.</p><p>Parallel-enabled HDF5 libraries are usually included in computing clusters and linked to the available MPI implementations. They are also available via the package manager of a number of Linux distributions.</p><p>Finally, note that the MPI.jl package is lazy-loaded by HDF5.jl using <a href="https://github.com/JuliaPackaging/Requires.jl">Requires</a>. In practice, this means that in Julia code, <code>MPI</code> must be imported <em>before</em> <code>HDF5</code> for parallel functionality to be available.</p><h2 id="Setting-up-Parallel-HDF5"><a class="docs-heading-anchor" href="#Setting-up-Parallel-HDF5">Setting-up Parallel HDF5</a><a id="Setting-up-Parallel-HDF5-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-Parallel-HDF5" title="Permalink"></a></h2><p>The following step-by-step guide assumes one already has access to parallel-enabled HDF5 libraries linked to an existent MPI installation.</p><h3 id="using_system_MPI"><a class="docs-heading-anchor" href="#using_system_MPI">1. Using system-provided MPI libraries</a><a id="using_system_MPI-1"></a><a class="docs-heading-anchor-permalink" href="#using_system_MPI" title="Permalink"></a></h3><p>Using a system-provided MPI library can be done with MPIPreferences.jl. After installing MPIPreferences.jl and running <code>julia --project -e &#39;using MPIPreferences; MPIPreferences.use_system_binary()&#39;</code> MPIPreferences.jl identifies any available MPI implementation and stores the information in a file LocalPreferences.toml. See the <a href="https://juliaparallel.org/MPI.jl/stable/configuration/#Using-a-system-provided-MPI-backend">MPI.jl docs</a> for details.</p><h3 id="using_parallel_HDF5"><a class="docs-heading-anchor" href="#using_parallel_HDF5">2. Using parallel HDF5 libraries</a><a id="using_parallel_HDF5-1"></a><a class="docs-heading-anchor-permalink" href="#using_parallel_HDF5" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">Migration from HDF5.jl v0.16 and earlier</header><div class="admonition-body"><p>How to use a system-provided HDF5 library has been changed in HDF5.jl v0.17. Previously, the library path was set by the environment variable <code>JULIA_HDF5_PATH</code>, which required to rebuild HDF5.jl afterwards. The environment variable has been removed and no longer has an effect (for backward compatibility it is still recommended to <strong>also</strong> set the environment variable). Instead, proceed as described below.</p></div></div><p>As detailed in <a href="../#Using-custom-or-system-provided-HDF5-binaries">Using custom or system provided HDF5 binaries</a>, set the preferences <code>libhdf5</code> and <code>libhdf5_hl</code> to the full path, where the parallel HDF5 binaries are located. This can be done by:</p><pre><code class="language-julia hljs">julia&gt; using Preferences, UUIDs

julia&gt; set_preferences!(
           UUID(&quot;f67ccb44-e63f-5c2f-98bd-6dc0ccc4ba2f&quot;), # UUID of HDF5.jl
           &quot;libhdf5&quot; =&gt; &quot;/path/to/your/libhdf5.so&quot;,
           &quot;libhdf5_hl&quot; =&gt; &quot;/path/to/your/libhdf5_hl.so&quot;,
           force = true)</code></pre><h3 id=".-Loading-MPI-enabled-HDF5"><a class="docs-heading-anchor" href="#.-Loading-MPI-enabled-HDF5">3. Loading MPI-enabled HDF5</a><a id=".-Loading-MPI-enabled-HDF5-1"></a><a class="docs-heading-anchor-permalink" href="#.-Loading-MPI-enabled-HDF5" title="Permalink"></a></h3><p>In Julia code, MPI.jl must be loaded <em>before</em> HDF5.jl for MPI functionality to be available:</p><pre><code class="language-julia hljs">using MPI
using HDF5

@assert HDF5.has_parallel()</code></pre><h3 id="Notes-to-HPC-cluster-administrators"><a class="docs-heading-anchor" href="#Notes-to-HPC-cluster-administrators">Notes to HPC cluster administrators</a><a id="Notes-to-HPC-cluster-administrators-1"></a><a class="docs-heading-anchor-permalink" href="#Notes-to-HPC-cluster-administrators" title="Permalink"></a></h3><p>More information for a setup at an HPC cluster can be found in the <a href="https://juliaparallel.org/MPI.jl/stable/configuration/#Notes-to-HPC-cluster-administrators">docs of MPI.jl</a>. After performing the steps <a href="#using_system_MPI">1.</a> and <a href="#using_parallel_HDF5">2.</a> the LocalPreferences.toml file could look something like the following:</p><pre><code class="language-toml hljs">[MPIPreferences]
_format = &quot;1.0&quot;
abi = &quot;OpenMPI&quot;
binary = &quot;system&quot;
libmpi = &quot;/software/mpi/lib/libmpi.so&quot;
mpiexec = &quot;/software/mpi/bin/mpiexec&quot;

[HDF5]
libhdf5 = &quot;/path/to/your/libhdf5.so&quot;
libhdf5_hl = &quot;/path/to/your/libhdf5_hl.so&quot;</code></pre><h3 id="Reading-and-writing-data-in-parallel"><a class="docs-heading-anchor" href="#Reading-and-writing-data-in-parallel">Reading and writing data in parallel</a><a id="Reading-and-writing-data-in-parallel-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-and-writing-data-in-parallel" title="Permalink"></a></h3><p>A parallel HDF5 file may be opened by passing a <code>MPI.Comm</code> (and optionally a <code>MPI.Info</code>) object to <a href="../interface/files/#HDF5.h5open"><code>h5open</code></a>. For instance:</p><pre><code class="language-julia hljs">comm = MPI.COMM_WORLD
info = MPI.Info()
ff = h5open(filename, &quot;w&quot;, comm, info)</code></pre><p>MPI-distributed data is typically written by first creating a dataset describing the global dimensions of the data. The following example writes a <code>10 × Nproc</code> array distributed over <code>Nproc</code> MPI processes.</p><pre><code class="language-julia hljs">Nproc = MPI.Comm_size(comm)
myrank = MPI.Comm_rank(comm)
M = 10
A = fill(myrank, M)  # local data
dims = (M, Nproc)    # dimensions of global data

# Create dataset
dset = create_dataset(ff, &quot;/data&quot;, datatype(eltype(A)), dataspace(dims))

# Write local data
dset[:, myrank + 1] = A</code></pre><p>Note that metadata operations, such as <code>create_dataset</code>, must be called <em>collectively</em> (on all processes at the same time, with the same arguments), but the actual writing to the dataset may be done independently. See <a href="https://portal.hdfgroup.org/display/HDF5/Collective+Calling+Requirements+in+Parallel+HDF5+Applications">Collective Calling Requirements in Parallel HDF5 Applications</a> for the exact requirements.</p><p>Sometimes, it may be more efficient to write data in chunks, so that each process writes to a separate chunk of the file. This is especially the case when data is uniformly distributed among MPI processes. In this example, this can be achieved by passing <code>chunk=(M, 1)</code> to <code>create_dataset</code>.</p><p>For better performance, it is sometimes preferable to perform <a href="https://portal.hdfgroup.org/display/HDF5/Introduction+to+Parallel+HDF5">collective I/O</a> when reading and writing datasets in parallel. This is achieved by passing <code>dxpl_mpio=:collective</code> to <code>create_dataset</code>. See also the <a href="https://portal.hdfgroup.org/display/HDF5/H5P_SET_DXPL_MPIO">HDF5 docs</a>.</p><p>A few more examples are available in <a href="https://github.com/JuliaIO/HDF5.jl/blob/master/test/mpio.jl"><code>test/mpio.jl</code></a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../interface/objects/">« Objects</a><a class="docs-footer-nextpage" href="../api_bindings/">Low-level library bindings »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 24 July 2023 16:28">Monday 24 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
