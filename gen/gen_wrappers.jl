include("bind_generator.jl")

# Read in the API definition macros from the definitions file
defs = read("api_defs.jl", String)
# Have Julia expand/run the @bind macro to generate expressions for all of the functions
exprs = Base.include_string(@__MODULE__, "@macroexpand1 begin\n" * defs * "\nend", "api_defs.jl")

# Now dump the text representation to disk
exprs = Base.remove_linenums!(exprs)
open(joinpath(@__DIR__, "..", "src", "api.jl"), "w") do fid
    println(fid, """
# This file is autogenerated by HDF5.jl's `gen/gen_wrappers.jl` and should not be editted.
#
# To add new bindings, define the binding in `gen/api_defs.jl`, re-run
# `gen/gen_wrappers.jl`, and commit the updated `src/api.jl`.
""")
    for func in exprs.args
        write(fid, string(func), "\n\n")
    end
end
